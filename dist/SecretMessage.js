function V(e){window.enmity.plugins.registerPlugin(e)}const f=window.enmity.modules.common.Constants;window.enmity.modules.common.Clipboard,window.enmity.modules.common.Assets;const b=window.enmity.modules.common.Messages;window.enmity.modules.common.Clyde,window.enmity.modules.common.Avatars,window.enmity.modules.common.Native;const r=window.enmity.modules.common.React;window.enmity.modules.common.Dispatcher,window.enmity.modules.common.Storage;const $=window.enmity.modules.common.Toasts;window.enmity.modules.common.Dialog,window.enmity.modules.common.Token,window.enmity.modules.common.REST,window.enmity.modules.common.Settings,window.enmity.modules.common.Users;const T=window.enmity.modules.common.Navigation;window.enmity.modules.common.NavigationNative,window.enmity.modules.common.NavigationStack,window.enmity.modules.common.Theme;const F=window.enmity.modules.common.Linking,K=window.enmity.modules.common.StyleSheet;window.enmity.modules.common.ColorMap,window.enmity.modules.common.Components,window.enmity.modules.common.Locale,window.enmity.modules.common.Profiles,window.enmity.modules.common.Lodash,window.enmity.modules.common.Logger,window.enmity.modules.common.Flux,window.enmity.modules.common.SVG,window.enmity.modules.common.Scenes,window.enmity.modules.common.Moment;const{components:o}=window.enmity;o.Alert,o.Button,o.FlatList;const Y=o.Image;o.ImageBackground,o.KeyboardAvoidingView,o.Modal;const z=o.Pressable;o.RefreshControl;const q=o.ScrollView;o.SectionList,o.StatusBar,o.StyleSheet,o.Switch;const S=o.Text;o.TextInput,o.TouchableHighlight,o.TouchableOpacity,o.TouchableWithoutFeedback,o.Touchable;const D=o.View;o.VirtualizedList,o.Form,o.FormArrow,o.FormCTA,o.FormCTAButton,o.FormCardSection,o.FormCheckbox,o.FormDivider,o.FormHint,o.FormIcon;const W=o.FormInput;o.FormLabel,o.FormRadio;const l=o.FormRow,R=o.FormSection;o.FormSelect,o.FormSubLabel;const N=o.FormSwitch;o.FormTernaryCheckBox,o.FormText,o.FormTextColors,o.FormTextSizes;const L={byProps:(...e)=>window.enmity.modules.filters.byProps(...e),byName:(e,t)=>window.enmity.modules.filters.byName(e,t),byTypeName:(e,t)=>window.enmity.modules.filters.byTypeName(e,t),byDisplayName:(e,t)=>window.enmity.modules.filters.byDisplayName(e,t)};function J(e,t){return window.enmity.modules.getModule(e,t)}function Q(...e){return window.enmity.modules.bulk(...e)}function X(...e){return window.enmity.modules.getByProps(...e)}window.enmity.modules.common;function Z(e,t,n){return window.enmity.utilities.findInReactTree(e,t,n)}function A(e){return window.enmity.assets.getByID(e)}function c(e){return window.enmity.assets.getIDByName(e)}function O(e){return window.enmity.patcher.create(e)}var a="SecretMessage",x="1.0.0",p="Send secret message that only your friend can understand.",ee=[{name:"mafu",id:"519760564755365888"}],te="#008b8b",ne={name:a,version:x,description:p,authors:ee,color:te};const{native:w}=window.enmity;function oe(){w.reload()}w.version,w.build,w.device,w.version;const re=c("ic_lock"),se=c("ic_gift"),ie=c("ic_message_retry"),le=c("img_account_sync_github_white"),ae=c("Discord"),ce=c("img_account_sync_twitter_white"),me=X("acceptInviteAndTransitionToInviteChannel");var ue=({settings:e})=>{const t=K.createThemedStyleSheet({container:{flexDirection:"row",justifyContent:"center",alignItems:"center"},image:{width:70,height:70,marginTop:20,marginLeft:20},title:{flexDirection:"column"},name:{fontSize:30,paddingTop:20,paddingLeft:20,paddingRight:30,color:f.ThemeColorMap.HEADER_PRIMARY},author:{fontSize:15,paddingLeft:50,color:f.ThemeColorMap.HEADER_SECONDARY},info:{height:45,paddingTop:3,paddingBottom:3,justifyContent:"center",alignItems:"center"},footer:{color:f.ThemeColorMap.HEADER_SECONDARY,textAlign:"center",paddingTop:10,paddingBottom:20}});return r.createElement(q,null,r.createElement(D,{style:t.container},r.createElement(Y,{source:{uri:"https://avatars.githubusercontent.com/u/43488869"},style:t.image}),r.createElement(D,{style:t.title},r.createElement(S,{style:t.name},"SecretMessage"),r.createElement(S,{style:t.author},"by mafu"))),r.createElement(R,{title:"SETTING"},r.createElement(W,{title:"Key",placeholder:"Input key you shared with your friend",value:e.get("key"),onSubmitEditing:n=>{e.set("key",n.nativeEvent.text)}}),r.createElement(l,{label:"Enable encryption",subLabel:"You can also enable it by tapping on the button in chat input if you enable the option below.",leading:r.createElement(l.Icon,{source:re}),trailing:r.createElement(N,{value:e.getBoolean("enabled",!1),onValueChange:n=>{e.set("enabled",n)}})}),r.createElement(l,{label:"Hijack gift button",subLabel:"Hijack useless gift button and change it to useful button :p",leading:r.createElement(l.Icon,{source:se}),trailing:r.createElement(N,{value:e.getBoolean("hijack_gift",!1),onValueChange:n=>{e.set("hijack_gift",n)}})}),r.createElement(l,{label:"Reload Discord",trailing:l.Arrow,leading:r.createElement(l.Icon,{source:ie}),subLabel:"You may need to reload Discord to apply changes to loaded messages.",onPress:()=>{oe()}})),r.createElement(R,{title:"INFORMATION"},r.createElement(l,{label:"Follow me on Twitter",style:t.info,trailing:l.Arrow,leading:r.createElement(l.Icon,{source:ce}),onPress:()=>{F.openURL("https://twitter.com/m4fn3")}}),r.createElement(l,{label:"Visit my server for help",style:t.info,trailing:l.Arrow,leading:r.createElement(l.Icon,{source:ae}),onPress:()=>{me.acceptInviteAndTransitionToInviteChannel({inviteKey:"TrCqPTCrdq",context:{location:"Invite Button Embed"},callback:()=>{T.pop()}})}}),r.createElement(l,{label:"Check Source on GitHub",style:t.info,trailing:l.Arrow,leading:r.createElement(l.Icon,{source:le}),onPress:()=>{F.openURL("https://github.com/m4fn3/SecretMessage")}})),r.createElement(S,{style:t.footer},`v${x}`))};const de=J(e=>e._dispatcher._actionHandlers._dependencyGraph.nodes),v=de._dispatcher._actionHandlers._dependencyGraph.nodes;function we(e){let t=Object.keys(v).filter(n=>v[n].name===e);if(t)return v[t[0]].actionHandler}function y(e,t,n){window.enmity.settings.set(e,t,n)}function m(e,t,n){return window.enmity.settings.get(e,t,n)}function E(e,t){let n="";for(let i=0;i<e.length;i++)n+=String.fromCharCode(e.charCodeAt(i)^t.charCodeAt(i%t.length));return n}function P(e){return`|${E("secret",e).slice(0,3)}|`}function _(e){let t=m(a,"key"),n=P(t);return e.startsWith(n)?`${E(e.slice(0,-1).replace(n,""),t)} \`[secret]\``:e}function G(e){let t=m(a,"key");return`${P(t)}${E(e,t)}|`}var C;(function(e){e[e.BuiltIn=0]="BuiltIn",e[e.Guild=1]="Guild",e[e.DM=2]="DM"})(C||(C={}));var k;(function(e){e[e.Chat=1]="Chat",e[e.User=2]="User",e[e.Message=3]="Message"})(k||(k={}));var I;(function(e){e[e.BuiltIn=0]="BuiltIn",e[e.BuiltInText=1]="BuiltInText",e[e.BuiltInIntegration=2]="BuiltInIntegration",e[e.Bot=3]="Bot",e[e.Placeholder=4]="Placeholder"})(I||(I={}));var H;(function(e){e[e.Role=1]="Role",e[e.User=2]="User"})(H||(H={}));var M;(function(e){e[e.SubCommand=1]="SubCommand",e[e.SubCommandGroup=2]="SubCommandGroup",e[e.String=3]="String",e[e.Integer=4]="Integer",e[e.Boolean=5]="Boolean",e[e.User=6]="User",e[e.Channel=7]="Channel",e[e.Role=8]="Role",e[e.Mentionnable=9]="Mentionnable",e[e.Number=10]="Number",e[e.Attachment=11]="Attachment"})(M||(M={}));var U;(function(e){e[e.ApplicationCommand=2]="ApplicationCommand",e[e.MessageComponent=3]="MessageComponent"})(U||(U={}));const ge=c("img_nitro_star"),ye={id:"secret",name:"secret",displayName:"secret",description:"Set key of SecretMessage",displayDescription:"Set key of SecretMessage",type:k.Chat,inputType:I.BuiltInText,options:[{name:"key",displayName:"key",description:"new key",displayDescription:"new key",type:M.String,required:!0}],execute:async function(e,t){let n=e[e.findIndex(i=>i.name==="key")].value;y(a,"key",n),$.open({content:`Successfully set new key to ${n}`,source:ge})}},u=O("SecretMessage"),[B]=[we("MessageStore")],[j,he]=Q(L.byProps("openSystemKeyboard"),L.byName("ChatInput",!1)),fe=c("ic_show_password"),be=c("ic_hide_password");function Se(e,t,n=!1){(n||m(a,e)===void 0)&&y(a,e,t)}const ve={...ne,onStart(){this.commands=[ye],[["enabled",!1],["key","default"],["hijack_gift",!0]].forEach(t=>{Se(...t)});let e=null;u.after(z.type,"render",(t,n,i)=>{var s,g,d;if(m(a,"hijack_gift")&&typeof((d=(g=(s=i.props)==null?void 0:s.children[0])==null?void 0:g.props)==null?void 0:d.source)=="number"){let h=i.props.children[0].props.source;if(e&&h!==e)return;if(!e)if(A(h).httpServerLocation==="/assets/modules/chat_input/native/images")e=h;else return;i.props.children[0].props.source=m(a,"enabled")?be:fe,n[0].onPress=()=>{y(a,"enabled",!m(a,"enabled")),j.openSystemKeyboard(),j.dismissKeyboard()}}}),u.after(he.default.prototype,"render",(t,n,i)=>{let s=Z(i,g=>{var d;return(d=g.props)==null?void 0:d.placeholder});s&&(s.props.placeholder=m(a,"enabled")?"Send *secret* message":"Send normal message")}),u.before(B,"LOAD_MESSAGES_SUCCESS",(t,n,i)=>{n[0].messages.map(s=>(s.content=s.content?_(s.content):s.content,s))}),u.before(B,"MESSAGE_CREATE",(t,n,i)=>{let s=n[0].message.content;n[0].message.content=s&&_(s)}),u.before(B,"MESSAGE_UPDATE",(t,n,i)=>{let s=n[0].message.content;n[0].message.content=s&&_(s)}),u.before(b,"sendMessage",(t,n,i)=>{if(m(a,"enabled")){let s=n[1].content;n[1].content=s&&G(s)}}),u.before(b,"editMessage",(t,n,i)=>{if(m(a,"enabled")){let s=n[2].content;n[2].content=s&&G(s)}}),u.before(b,"startEditMessage",(t,n,i)=>{n[2]=n[2].replace("`[secret]`","")})},onStop(){this.commands=[],u.unpatchAll()},getSettingsPanel({settings:e}){return r.createElement(ue,{settings:e})}};V(ve);
