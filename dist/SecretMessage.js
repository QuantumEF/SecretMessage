function L(e){window.enmity.plugins.registerPlugin(e)}const p=window.enmity.modules.common.Constants;window.enmity.modules.common.Clipboard,window.enmity.modules.common.Assets;const h=window.enmity.modules.common.Messages;window.enmity.modules.common.Clyde,window.enmity.modules.common.Avatars,window.enmity.modules.common.Native;const i=window.enmity.modules.common.React;window.enmity.modules.common.Dispatcher,window.enmity.modules.common.Storage,window.enmity.modules.common.Toasts,window.enmity.modules.common.Dialog,window.enmity.modules.common.Token,window.enmity.modules.common.REST,window.enmity.modules.common.Settings,window.enmity.modules.common.Users;const N=window.enmity.modules.common.Navigation;window.enmity.modules.common.NavigationNative,window.enmity.modules.common.NavigationStack,window.enmity.modules.common.Theme;const C=window.enmity.modules.common.Linking,P=window.enmity.modules.common.StyleSheet;window.enmity.modules.common.ColorMap,window.enmity.modules.common.Components,window.enmity.modules.common.Locale,window.enmity.modules.common.Profiles,window.enmity.modules.common.Lodash,window.enmity.modules.common.Logger,window.enmity.modules.common.Flux,window.enmity.modules.common.SVG,window.enmity.modules.common.Scenes,window.enmity.modules.common.Moment;const{components:n}=window.enmity;n.Alert,n.Button,n.FlatList;const B=n.Image;n.ImageBackground,n.KeyboardAvoidingView,n.Modal;const x=n.Pressable;n.RefreshControl;const H=n.ScrollView;n.SectionList,n.StatusBar,n.StyleSheet,n.Switch;const f=n.Text;n.TextInput,n.TouchableHighlight,n.TouchableOpacity,n.TouchableWithoutFeedback,n.Touchable;const _=n.View;n.VirtualizedList,n.Form,n.FormArrow,n.FormCTA,n.FormCTAButton,n.FormCardSection,n.FormCheckbox,n.FormDivider,n.FormHint,n.FormIcon;const j=n.FormInput;n.FormLabel,n.FormRadio;const a=n.FormRow,I=n.FormSection;n.FormSelect,n.FormSubLabel;const A=n.FormSwitch;n.FormTernaryCheckBox,n.FormText,n.FormTextColors,n.FormTextSizes;const F={byProps:(...e)=>window.enmity.modules.filters.byProps(...e),byName:(e,t)=>window.enmity.modules.filters.byName(e,t),byTypeName:(e,t)=>window.enmity.modules.filters.byTypeName(e,t),byDisplayName:(e,t)=>window.enmity.modules.filters.byDisplayName(e,t)};function V(e,t){return window.enmity.modules.getModule(e,t)}function G(...e){return window.enmity.modules.bulk(...e)}function $(...e){return window.enmity.modules.getByProps(...e)}window.enmity.modules.common;function K(e,t,o){return window.enmity.utilities.findInReactTree(e,t,o)}function O(e){return window.enmity.assets.getByID(e)}function d(e){return window.enmity.assets.getIDByName(e)}function U(e){return window.enmity.patcher.create(e)}var m="SecretMessage",k="1.0.0",Y="Send secret message that only your friend can understand.",z=[{name:"mafu",id:"519760564755365888"}],q="#008b8b",W={name:m,version:k,description:Y,authors:z,color:q};const{native:w}=window.enmity;function J(){w.reload()}w.version,w.build,w.device,w.version;const Q=d("ic_lock"),X=d("ic_gift"),Z=d("ic_message_retry"),ee=d("img_account_sync_github_white"),te=d("Discord"),ne=d("img_account_sync_twitter_white"),oe=$("acceptInviteAndTransitionToInviteChannel");var ie=({settings:e})=>{const t=P.createThemedStyleSheet({container:{flexDirection:"row",justifyContent:"center",alignItems:"center"},image:{width:70,height:70,marginTop:20,marginLeft:20},title:{flexDirection:"column"},name:{fontSize:30,paddingTop:20,paddingLeft:20,paddingRight:30,color:p.ThemeColorMap.HEADER_PRIMARY},author:{fontSize:15,paddingLeft:50,color:p.ThemeColorMap.HEADER_SECONDARY},info:{height:45,paddingTop:3,paddingBottom:3,justifyContent:"center",alignItems:"center"},footer:{color:p.ThemeColorMap.HEADER_SECONDARY,textAlign:"center",paddingTop:10,paddingBottom:20}});return i.createElement(H,null,i.createElement(_,{style:t.container},i.createElement(B,{source:{uri:"https://avatars.githubusercontent.com/u/43488869"},style:t.image}),i.createElement(_,{style:t.title},i.createElement(f,{style:t.name},"SecretMessage"),i.createElement(f,{style:t.author},"by mafu"))),i.createElement(I,{title:"SETTING"},i.createElement(j,{title:"Key",placeholder:"Input key you shared with your friend",value:e.get("key"),onSubmitEditing:o=>{e.set("key",o.nativeEvent.text)}}),i.createElement(a,{label:"Enable encryption",subLabel:"You enable it by tapping on the button in chat input if you enable the option below.",leading:i.createElement(a.Icon,{source:Q}),trailing:i.createElement(A,{value:e.getBoolean("enabled",!1),onValueChange:o=>{e.set("enabled",o)}})}),i.createElement(a,{label:"Hijack gift button",subLabel:"Hijack useless gift button and change it to useful button :p",leading:i.createElement(a.Icon,{source:X}),trailing:i.createElement(A,{value:e.getBoolean("hijack_gift",!1),onValueChange:o=>{e.set("hijack_gift",o)}})}),i.createElement(a,{label:"Reload Discord",trailing:a.Arrow,leading:i.createElement(a.Icon,{source:Z}),subLabel:"You may need to reload Discord to apply changes to loaded messages.",onPress:()=>{J()}})),i.createElement(I,{title:"INFORMATION"},i.createElement(a,{label:"Follow me on Twitter",style:t.info,trailing:a.Arrow,leading:i.createElement(a.Icon,{source:ne}),onPress:()=>{C.openURL("https://twitter.com/m4fn3")}}),i.createElement(a,{label:"Visit my server for help",style:t.info,trailing:a.Arrow,leading:i.createElement(a.Icon,{source:te}),onPress:()=>{oe.acceptInviteAndTransitionToInviteChannel({inviteKey:"TrCqPTCrdq",context:{location:"Invite Button Embed"},callback:()=>{N.pop()}})}}),i.createElement(a,{label:"Check Source on GitHub",style:t.info,trailing:a.Arrow,leading:i.createElement(a.Icon,{source:ee}),onPress:()=>{C.openURL("https://github.com/m4fn3/SecretMessage")}})),i.createElement(f,{style:t.footer},`v${k}`))};const re=V(e=>e._dispatcher._actionHandlers._dependencyGraph.nodes),b=re._dispatcher._actionHandlers._dependencyGraph.nodes;function se(e){let t=Object.keys(b).filter(o=>b[o].name===e);if(t)return b[t[0]].actionHandler}function S(e,t,o){window.enmity.settings.set(e,t,o)}function l(e,t,o){return window.enmity.settings.get(e,t,o)}function E(e,t){let o="";for(let s=0;s<e.length;s++)o+=String.fromCharCode(e.charCodeAt(s)^t.charCodeAt(s%t.length));return o}function M(e){return`|${E(m,e).slice(0,3)}|`}function v(e){let t=l(m,"key"),o=M(t);return e.startsWith(o)?`${E(e.slice(0,-1).replace(o,""),t)} \`[secret]\``:e}function D(e){let t=l(m,"key");return`${M(t)}${E(e,t)}|`}const c=U("SecretMessage"),[T]=[se("MessageStore")],[R,ae]=G(F.byProps("openSystemKeyboard"),F.byName("ChatInput",!1)),me=d("ic_show_password"),le=d("ic_hide_password");function ce(e,t,o=!1){(o||l(m,e)===void 0)&&S(m,e,t)}const de={...W,onStart(){[["enabled",!1],["key","default"],["hijack_gift",!0]].forEach(t=>{ce(...t)});let e=null;c.after(x.type,"render",(t,o,s)=>{var r,y,u;if(l(m,"hijack_gift")&&typeof((u=(y=(r=s.props)==null?void 0:r.children[0])==null?void 0:y.props)==null?void 0:u.source)=="number"){let g=s.props.children[0].props.source;if(e&&g!==e)return;if(!e)if(O(g).httpServerLocation==="/assets/modules/chat_input/native/images")e=g;else return;s.props.children[0].props.source=l(m,"enabled")?me:le,o[0].onPress=()=>{S(m,"enabled",!l(m,"enabled")),R.openSystemKeyboard(),R.dismissKeyboard()}}}),c.after(ae.default.prototype,"render",(t,o,s)=>{let r=K(s,y=>{var u;return(u=y.props)==null?void 0:u.placeholder});r&&(r.props.placeholder=l(m,"enabled")?"Send *secret* message":"Send normal message")}),c.before(T,"LOAD_MESSAGES_SUCCESS",(t,o,s)=>{o[0].messages.map(r=>(r.content=r.content?v(r.content):r.content,r))}),c.before(T,"MESSAGE_CREATE",(t,o,s)=>{let r=o[0].message.content;o[0].message.content=r&&v(r)}),c.before(T,"MESSAGE_UPDATE",(t,o,s)=>{let r=o[0].message.content;o[0].message.content=r&&v(r)}),c.before(h,"sendMessage",(t,o,s)=>{if(l(m,"enabled")){let r=o[1].content;o[1].content=r&&D(r)}}),c.before(h,"editMessage",(t,o,s)=>{if(l(m,"enabled")){let r=o[2].content;o[2].content=r&&D(r)}}),c.before(h,"startEditMessage",(t,o,s)=>{o[2]=o[2].replace("`[secret]`","")})},onStop(){c.unpatchAll()},getSettingsPanel({settings:e}){return i.createElement(ie,{settings:e})}};L(de);
