function M(e){window.enmity.plugins.registerPlugin(e)}const w=window.enmity.modules.common.Constants;window.enmity.modules.common.Clipboard,window.enmity.modules.common.Assets;const y=window.enmity.modules.common.Messages;window.enmity.modules.common.Clyde,window.enmity.modules.common.Avatars,window.enmity.modules.common.Native;const r=window.enmity.modules.common.React;window.enmity.modules.common.Dispatcher,window.enmity.modules.common.Storage,window.enmity.modules.common.Toasts,window.enmity.modules.common.Dialog,window.enmity.modules.common.Token,window.enmity.modules.common.REST,window.enmity.modules.common.Settings,window.enmity.modules.common.Users;const R=window.enmity.modules.common.Navigation;window.enmity.modules.common.NavigationNative,window.enmity.modules.common.NavigationStack,window.enmity.modules.common.Theme;const E=window.enmity.modules.common.Linking,N=window.enmity.modules.common.StyleSheet;window.enmity.modules.common.ColorMap,window.enmity.modules.common.Components,window.enmity.modules.common.Locale,window.enmity.modules.common.Profiles,window.enmity.modules.common.Lodash,window.enmity.modules.common.Logger,window.enmity.modules.common.Flux,window.enmity.modules.common.SVG,window.enmity.modules.common.Scenes,window.enmity.modules.common.Moment;const{components:n}=window.enmity;n.Alert,n.Button,n.FlatList;const L=n.Image;n.ImageBackground,n.KeyboardAvoidingView,n.Modal;const P=n.Pressable;n.RefreshControl;const D=n.ScrollView;n.SectionList,n.StatusBar,n.StyleSheet,n.Switch;const g=n.Text;n.TextInput,n.TouchableHighlight,n.TouchableOpacity,n.TouchableWithoutFeedback,n.Touchable;const T=n.View;n.VirtualizedList,n.Form,n.FormArrow,n.FormCTA,n.FormCTAButton,n.FormCardSection,n.FormCheckbox,n.FormDivider,n.FormHint,n.FormIcon;const x=n.FormInput;n.FormLabel,n.FormRadio;const s=n.FormRow,v=n.FormSection;n.FormSelect,n.FormSubLabel;const C=n.FormSwitch;n.FormTernaryCheckBox,n.FormText,n.FormTextColors,n.FormTextSizes;const I={byProps:(...e)=>window.enmity.modules.filters.byProps(...e),byName:(e,t)=>window.enmity.modules.filters.byName(e,t),byTypeName:(e,t)=>window.enmity.modules.filters.byTypeName(e,t),byDisplayName:(e,t)=>window.enmity.modules.filters.byDisplayName(e,t)};function B(e,t){return window.enmity.modules.getModule(e,t)}function H(...e){return window.enmity.modules.bulk(...e)}function j(...e){return window.enmity.modules.getByProps(...e)}window.enmity.modules.common;function V(e,t,o){return window.enmity.utilities.findInReactTree(e,t,o)}function c(e){return window.enmity.assets.getIDByName(e)}function $(e){return window.enmity.patcher.create(e)}var m="SecretMessage",_="1.0.0",G="Send secret message that only your friend can understand.",K=[{name:"mafu",id:"519760564755365888"}],O="#008b8b",U={name:m,version:_,description:G,authors:K,color:O};const z=c("ic_lock"),Y=c("ic_gift"),q=c("img_account_sync_github_white"),W=c("Discord"),J=c("img_account_sync_twitter_white"),Q=j("acceptInviteAndTransitionToInviteChannel");var X=({settings:e})=>{const t=N.createThemedStyleSheet({container:{flexDirection:"row",justifyContent:"center",alignItems:"center"},image:{width:70,height:70,marginTop:20,marginLeft:20},title:{flexDirection:"column"},name:{fontSize:30,paddingTop:20,paddingLeft:20,paddingRight:30,color:w.ThemeColorMap.HEADER_PRIMARY},author:{fontSize:15,paddingLeft:50,color:w.ThemeColorMap.HEADER_SECONDARY},info:{height:45,paddingTop:3,paddingBottom:3,justifyContent:"center",alignItems:"center"},footer:{color:w.ThemeColorMap.HEADER_SECONDARY,textAlign:"center",paddingTop:10,paddingBottom:20}});return r.createElement(D,null,r.createElement(T,{style:t.container},r.createElement(L,{source:{uri:"https://avatars.githubusercontent.com/u/43488869"},style:t.image}),r.createElement(T,{style:t.title},r.createElement(g,{style:t.name},"SecretMessage"),r.createElement(g,{style:t.author},"by mafu"))),r.createElement(v,{title:"SETTING"},r.createElement(x,{title:"Key",placeholder:"Input key you shared with your friend",value:e.get("key"),onSubmitEditing:o=>{e.set("key",o.nativeEvent.text)}}),r.createElement(s,{label:"Enable encryption",subLabel:"You enable it by tapping on the button in chat input if you enable the option below.",leading:r.createElement(s.Icon,{source:z}),trailing:r.createElement(C,{value:e.getBoolean("enabled",!1),onValueChange:o=>{e.set("enabled",o)}})}),r.createElement(s,{label:"Hijack gift button",subLabel:"Hijack useless gift button and change it to useful button :p",leading:r.createElement(s.Icon,{source:Y}),trailing:r.createElement(C,{value:e.getBoolean("hijack_gift",!1),onValueChange:o=>{e.set("hijack_gift",o)}})})),r.createElement(v,{title:"INFORMATION"},r.createElement(s,{label:"Follow me on Twitter",style:t.info,trailing:s.Arrow,leading:r.createElement(s.Icon,{source:J}),onPress:()=>{E.openURL("https://twitter.com/m4fn3")}}),r.createElement(s,{label:"Visit my server for help",style:t.info,trailing:s.Arrow,leading:r.createElement(s.Icon,{source:W}),onPress:()=>{Q.acceptInviteAndTransitionToInviteChannel({inviteKey:"TrCqPTCrdq",context:{location:"Invite Button Embed"},callback:()=>{R.pop()}})}}),r.createElement(s,{label:"Check Source on GitHub",style:t.info,trailing:s.Arrow,leading:r.createElement(s.Icon,{source:q}),onPress:()=>{E.openURL("https://github.com/m4fn3/SecretMessage")}})),r.createElement(g,{style:t.footer},`v${_}`))};const Z=B(e=>e._dispatcher._actionHandlers._dependencyGraph.nodes),p=Z._dispatcher._actionHandlers._dependencyGraph.nodes;function ee(e){let t=Object.keys(p).filter(o=>p[o].name===e);if(t)return p[t[0]].actionHandler}function h(e,t,o){window.enmity.settings.set(e,t,o)}function a(e,t,o){return window.enmity.settings.get(e,t,o)}function f(e,t){let o="";for(let i=0;i<e.length;i++)o+=String.fromCharCode(e.charCodeAt(i)^t.charCodeAt(i%t.length));return o}function A(e){return`|${f(m,e).slice(0,3)}|`}function b(e){let t=a(m,"key"),o=A(t);return e.startsWith(o)?`${f(e.slice(0,-1).replace(o,""),t)} \`[secret]\``:e}function F(e){let t=a(m,"key");return`${A(t)}${f(e,t)}|`}const l=$("SecretMessage"),[S]=[ee("MessageStore")],[k,te]=H(I.byProps("openSystemKeyboard"),I.byName("ChatInput",!1)),ne=c("ic_show_password"),oe=c("ic_hide_password");function ie(e,t,o=!1){(o||a(m,e)===void 0)&&h(m,e,t)}const re={...U,onStart(){[["enabled",!1],["key","default"],["hijack_gift",!0]].forEach(e=>{ie(...e)}),l.after(P.type,"render",(e,t,o)=>{var i,u,d;a(m,"hijack_gift")&&((d=(u=(i=o.props)==null?void 0:i.children[0])==null?void 0:u.props)==null?void 0:d.source)===692&&(o.props.children[0].props.source=a(m,"enabled")?ne:oe,t[0].onPress=()=>{h(m,"enabled",!a(m,"enabled")),k.openSystemKeyboard(),k.dismissKeyboard()})}),l.after(te.default.prototype,"render",(e,t,o)=>{let i=V(o,u=>{var d;return(d=u.props)==null?void 0:d.placeholder});i&&(i.props.placeholder=a(m,"enabled")?"send secret message":i.props.placeholder)}),l.before(S,"LOAD_MESSAGES_SUCCESS",(e,t,o)=>{t[0].messages.map(i=>(i.content=i.content?b(i.content):i.content,i))}),l.before(S,"MESSAGE_CREATE",(e,t,o)=>{let i=t[0].message.content;t[0].message.content=i&&b(i)}),l.before(S,"MESSAGE_UPDATE",(e,t,o)=>{let i=t[0].message.content;t[0].message.content=i&&b(i)}),l.before(y,"sendMessage",(e,t,o)=>{if(a(m,"enabled")){let i=t[1].content;t[1].content=i&&F(i)}}),l.before(y,"editMessage",(e,t,o)=>{if(a(m,"enabled")){let i=t[2].content;t[2].content=i&&F(i)}}),l.before(y,"startEditMessage",(e,t,o)=>{t[2]=t[2].replace("`[secret]`","")})},onStop(){l.unpatchAll()},getSettingsPanel({settings:e}){return r.createElement(X,{settings:e})}};M(re);
