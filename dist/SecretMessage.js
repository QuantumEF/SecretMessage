function V(e){window.enmity.plugins.registerPlugin(e)}const f=window.enmity.modules.common.Constants;window.enmity.modules.common.Clipboard,window.enmity.modules.common.Assets;const b=window.enmity.modules.common.Messages;window.enmity.modules.common.Clyde,window.enmity.modules.common.Avatars,window.enmity.modules.common.Native;const s=window.enmity.modules.common.React;window.enmity.modules.common.Dispatcher,window.enmity.modules.common.Storage;const T=window.enmity.modules.common.Toasts;window.enmity.modules.common.Dialog,window.enmity.modules.common.Token,window.enmity.modules.common.REST,window.enmity.modules.common.Settings,window.enmity.modules.common.Users;const K=window.enmity.modules.common.Navigation;window.enmity.modules.common.NavigationNative,window.enmity.modules.common.NavigationStack,window.enmity.modules.common.Theme;const F=window.enmity.modules.common.Linking,Y=window.enmity.modules.common.StyleSheet;window.enmity.modules.common.ColorMap,window.enmity.modules.common.Components,window.enmity.modules.common.Locale,window.enmity.modules.common.Profiles,window.enmity.modules.common.Lodash,window.enmity.modules.common.Logger,window.enmity.modules.common.Flux,window.enmity.modules.common.SVG,window.enmity.modules.common.Scenes,window.enmity.modules.common.Moment;const{components:o}=window.enmity;o.Alert,o.Button,o.FlatList;const z=o.Image;o.ImageBackground,o.KeyboardAvoidingView,o.Modal;const q=o.Pressable;o.RefreshControl;const W=o.ScrollView;o.SectionList,o.StatusBar,o.StyleSheet,o.Switch;const S=o.Text;o.TextInput,o.TouchableHighlight,o.TouchableOpacity,o.TouchableWithoutFeedback,o.Touchable;const R=o.View;o.VirtualizedList,o.Form,o.FormArrow,o.FormCTA,o.FormCTAButton,o.FormCardSection,o.FormCheckbox,o.FormDivider,o.FormHint,o.FormIcon;const J=o.FormInput;o.FormLabel,o.FormRadio;const l=o.FormRow,D=o.FormSection;o.FormSelect,o.FormSubLabel;const N=o.FormSwitch;o.FormTernaryCheckBox,o.FormText,o.FormTextColors,o.FormTextSizes;const x={byProps:(...e)=>window.enmity.modules.filters.byProps(...e),byName:(e,t)=>window.enmity.modules.filters.byName(e,t),byTypeName:(e,t)=>window.enmity.modules.filters.byTypeName(e,t),byDisplayName:(e,t)=>window.enmity.modules.filters.byDisplayName(e,t)};function Q(e,t){return window.enmity.modules.getModule(e,t)}function X(...e){return window.enmity.modules.bulk(...e)}function Z(...e){return window.enmity.modules.getByProps(...e)}window.enmity.modules.common;function A(e,t,n){return window.enmity.utilities.findInReactTree(e,t,n)}function O(e){return window.enmity.assets.getByID(e)}function m(e){return window.enmity.assets.getIDByName(e)}function p(e){return window.enmity.patcher.create(e)}var a="SecretMessage",L="1.0.0",ee="Send secret message that only your friend can understand.",te=[{name:"mafu",id:"519760564755365888"}],ne="#008b8b",oe={name:a,version:L,description:ee,authors:te,color:ne};const{native:w}=window.enmity;function re(){w.reload()}w.version,w.build,w.device,w.version;const se=m("ic_lock"),ie=m("ic_gift"),le=m("ic_message_retry"),ae=m("img_account_sync_github_white"),ce=m("Discord"),me=m("img_account_sync_twitter_white"),ue=Z("acceptInviteAndTransitionToInviteChannel");var de=({settings:e})=>{const t=Y.createThemedStyleSheet({container:{flexDirection:"row",justifyContent:"center",alignItems:"center"},image:{width:70,height:70,marginTop:20,marginLeft:20},title:{flexDirection:"column"},name:{fontSize:30,paddingTop:20,paddingLeft:20,paddingRight:30,color:f.ThemeColorMap.HEADER_PRIMARY},author:{fontSize:15,paddingLeft:50,color:f.ThemeColorMap.HEADER_SECONDARY},info:{height:45,paddingTop:3,paddingBottom:3,justifyContent:"center",alignItems:"center"},footer:{color:f.ThemeColorMap.HEADER_SECONDARY,textAlign:"center",paddingTop:10,paddingBottom:20}});return s.createElement(W,null,s.createElement(R,{style:t.container},s.createElement(z,{source:{uri:"https://avatars.githubusercontent.com/u/43488869"},style:t.image}),s.createElement(R,{style:t.title},s.createElement(S,{style:t.name},"SecretMessage"),s.createElement(S,{style:t.author},"by mafu"))),s.createElement(D,{title:"SETTING"},s.createElement(J,{title:"Key",placeholder:"Input key you shared with your friend",value:e.get("key"),onSubmitEditing:n=>{e.set("key",n.nativeEvent.text)}}),s.createElement(l,{label:"Enable encryption",subLabel:"You can also enable it by tapping on the button in chat input if you enable the option below.",leading:s.createElement(l.Icon,{source:se}),trailing:s.createElement(N,{value:e.getBoolean("enabled",!1),onValueChange:n=>{e.set("enabled",n)}})}),s.createElement(l,{label:"Hijack gift button",subLabel:"Hijack useless gift button and change it to useful button :p",leading:s.createElement(l.Icon,{source:ie}),trailing:s.createElement(N,{value:e.getBoolean("hijack_gift",!1),onValueChange:n=>{e.set("hijack_gift",n)}})}),s.createElement(l,{label:"Reload Discord",trailing:l.Arrow,leading:s.createElement(l.Icon,{source:le}),subLabel:"You need to reload Discord if you wanna apply changes to loaded messages too.",onPress:()=>{re()}})),s.createElement(D,{title:"INFORMATION"},s.createElement(l,{label:"Follow me on Twitter",style:t.info,trailing:l.Arrow,leading:s.createElement(l.Icon,{source:me}),onPress:()=>{F.openURL("https://twitter.com/m4fn3")}}),s.createElement(l,{label:"Visit my server for help",style:t.info,trailing:l.Arrow,leading:s.createElement(l.Icon,{source:ce}),onPress:()=>{ue.acceptInviteAndTransitionToInviteChannel({inviteKey:"TrCqPTCrdq",context:{location:"Invite Button Embed"},callback:()=>{K.pop()}})}}),s.createElement(l,{label:"Check Source on GitHub",style:t.info,trailing:l.Arrow,leading:s.createElement(l.Icon,{source:ae}),onPress:()=>{F.openURL("https://github.com/m4fn3/SecretMessage")}})),s.createElement(S,{style:t.footer},`v${L}`))};const ge=Q(e=>e._dispatcher._actionHandlers._dependencyGraph.nodes),v=ge._dispatcher._actionHandlers._dependencyGraph.nodes;function we(e){let t=Object.keys(v).filter(n=>v[n].name===e);if(t)return v[t[0]].actionHandler}function y(e,t,n){window.enmity.settings.set(e,t,n)}function c(e,t,n){return window.enmity.settings.get(e,t,n)}function E(e,t){let n="";for(let i=0;i<e.length;i++)n+=String.fromCharCode(e.charCodeAt(i)^t.charCodeAt(i%t.length));return n}function P(e){return`|${E("secret",e).slice(0,3)}|`}function $(e){return`\`<${e.slice(0,2)}${"*".repeat(Math.max(e.length-2,0))}>\``}function _(e){let t=c(a,"key"),n=P(t),i=$(t);return e.startsWith(n)?`${E(e.slice(0,-1).replace(n,""),t)} ${i}`:e}function G(e){let t=c(a,"key");return`${P(t)}${E(e,t)}|`}var C;(function(e){e[e.BuiltIn=0]="BuiltIn",e[e.Guild=1]="Guild",e[e.DM=2]="DM"})(C||(C={}));var k;(function(e){e[e.Chat=1]="Chat",e[e.User=2]="User",e[e.Message=3]="Message"})(k||(k={}));var I;(function(e){e[e.BuiltIn=0]="BuiltIn",e[e.BuiltInText=1]="BuiltInText",e[e.BuiltInIntegration=2]="BuiltInIntegration",e[e.Bot=3]="Bot",e[e.Placeholder=4]="Placeholder"})(I||(I={}));var H;(function(e){e[e.Role=1]="Role",e[e.User=2]="User"})(H||(H={}));var M;(function(e){e[e.SubCommand=1]="SubCommand",e[e.SubCommandGroup=2]="SubCommandGroup",e[e.String=3]="String",e[e.Integer=4]="Integer",e[e.Boolean=5]="Boolean",e[e.User=6]="User",e[e.Channel=7]="Channel",e[e.Role=8]="Role",e[e.Mentionnable=9]="Mentionnable",e[e.Number=10]="Number",e[e.Attachment=11]="Attachment"})(M||(M={}));var U;(function(e){e[e.ApplicationCommand=2]="ApplicationCommand",e[e.MessageComponent=3]="MessageComponent"})(U||(U={}));const ye=m("img_nitro_star"),he={id:"secret",name:"secret",displayName:"secret",description:"Set key of SecretMessage",displayDescription:"Set key of SecretMessage",type:k.Chat,inputType:I.BuiltInText,options:[{name:"key",displayName:"key",description:"new key",displayDescription:"new key",type:M.String,required:!0}],execute:async function(e,t){let n=e[e.findIndex(i=>i.name==="key")].value;y(a,"key",n),T.open({content:`Successfully set new key to ${n}`,source:ye})}},u=p("SecretMessage"),[B]=[we("MessageStore")],[j,fe]=X(x.byProps("openSystemKeyboard"),x.byName("ChatInput",!1)),be=m("ic_show_password"),Se=m("ic_hide_password");function ve(e,t,n=!1){(n||c(a,e)===void 0)&&y(a,e,t)}const Ee={...oe,onStart(){this.commands=[he],[["enabled",!1],["key","default"],["hijack_gift",!0]].forEach(t=>{ve(...t)});let e=null;u.after(q.type,"render",(t,n,i)=>{var r,d,g;if(c(a,"hijack_gift")&&typeof((g=(d=(r=i.props)==null?void 0:r.children[0])==null?void 0:d.props)==null?void 0:g.source)=="number"){let h=i.props.children[0].props.source;if(e&&h!==e)return;if(!e)if(O(h).httpServerLocation==="/assets/modules/chat_input/native/images")e=h;else return;i.props.children[0].props.source=c(a,"enabled")?Se:be,n[0].onPress=()=>{y(a,"enabled",!c(a,"enabled")),j.openSystemKeyboard(),j.dismissKeyboard()}}}),u.after(fe.default.prototype,"render",(t,n,i)=>{let r=A(i,d=>{var g;return(g=d.props)==null?void 0:g.placeholder});r&&(r.props.placeholder=c(a,"enabled")?"Send *secret* message":"Send normal message")}),u.before(B,"LOAD_MESSAGES_SUCCESS",(t,n,i)=>{n[0].messages.map(r=>(r.content=r.content?_(r.content):r.content,r))}),u.before(B,"MESSAGE_CREATE",(t,n,i)=>{let r=n[0].message.content;n[0].message.content=r&&_(r)}),u.before(B,"MESSAGE_UPDATE",(t,n,i)=>{let r=n[0].message.content;n[0].message.content=r&&_(r)}),u.before(b,"sendMessage",(t,n,i)=>{if(c(a,"enabled")){let r=n[1].content;n[1].content=r&&G(r)}}),u.before(b,"editMessage",(t,n,i)=>{if(c(a,"enabled")){let r=n[2].content;n[2].content=r&&G(r)}}),u.before(b,"startEditMessage",(t,n,i)=>{let r=c(a,"key"),d=$(r);n[2]=n[2].replace(d,"")})},onStop(){this.commands=[],u.unpatchAll()},getSettingsPanel({settings:e}){return s.createElement(de,{settings:e})}};V(Ee);
