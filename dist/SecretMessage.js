function W(e){window.enmity.plugins.registerPlugin(e)}const E=window.enmity.modules.common.Constants;window.enmity.modules.common.Clipboard,window.enmity.modules.common.Assets;const _=window.enmity.modules.common.Messages;window.enmity.modules.common.Clyde,window.enmity.modules.common.Avatars,window.enmity.modules.common.Native;const s=window.enmity.modules.common.React;window.enmity.modules.common.Dispatcher,window.enmity.modules.common.Storage;const J=window.enmity.modules.common.Toasts;window.enmity.modules.common.Dialog,window.enmity.modules.common.Token,window.enmity.modules.common.REST,window.enmity.modules.common.Settings,window.enmity.modules.common.Users;const Q=window.enmity.modules.common.Navigation;window.enmity.modules.common.NavigationNative,window.enmity.modules.common.NavigationStack,window.enmity.modules.common.Theme;const C=window.enmity.modules.common.Linking,X=window.enmity.modules.common.StyleSheet;window.enmity.modules.common.ColorMap,window.enmity.modules.common.Components,window.enmity.modules.common.Locale,window.enmity.modules.common.Profiles,window.enmity.modules.common.Lodash,window.enmity.modules.common.Logger,window.enmity.modules.common.Flux,window.enmity.modules.common.SVG,window.enmity.modules.common.Scenes,window.enmity.modules.common.Moment;const{components:t}=window.enmity;t.Alert,t.Button,t.FlatList;const Z=t.Image;t.ImageBackground,t.KeyboardAvoidingView,t.Modal;const A=t.Pressable;t.RefreshControl;const O=t.ScrollView;t.SectionList,t.StatusBar,t.StyleSheet,t.Switch;const k=t.Text;t.TextInput,t.TouchableHighlight,t.TouchableOpacity,t.TouchableWithoutFeedback,t.Touchable;const G=t.View;t.VirtualizedList,t.Form,t.FormArrow,t.FormCTA,t.FormCTAButton,t.FormCardSection,t.FormCheckbox,t.FormDivider,t.FormHint,t.FormIcon;const p=t.FormInput;t.FormLabel,t.FormRadio;const a=t.FormRow,U=t.FormSection;t.FormSelect,t.FormSubLabel;const $=t.FormSwitch;t.FormTernaryCheckBox,t.FormText,t.FormTextColors,t.FormTextSizes;const H={byProps:(...e)=>window.enmity.modules.filters.byProps(...e),byName:(e,n)=>window.enmity.modules.filters.byName(e,n),byTypeName:(e,n)=>window.enmity.modules.filters.byTypeName(e,n),byDisplayName:(e,n)=>window.enmity.modules.filters.byDisplayName(e,n)};function ee(e,n){return window.enmity.modules.getModule(e,n)}function te(...e){return window.enmity.modules.bulk(...e)}function ne(...e){return window.enmity.modules.getByProps(...e)}window.enmity.modules.common;function oe(e,n,o){return window.enmity.utilities.findInReactTree(e,n,o)}function re(e){return window.enmity.assets.getByID(e)}function d(e){return window.enmity.assets.getIDByName(e)}function se(e){return window.enmity.patcher.create(e)}var c="SecretMessage",V="1.0.0",ie="Send secret message that only your friend can understand.",le=[{name:"mafu",id:"519760564755365888"}],ae="#008b8b",ce={name:c,version:V,description:ie,authors:le,color:ae};const{native:h}=window.enmity;function me(){h.reload()}h.version,h.build,h.device,h.version;const de=d("ic_lock"),ue=d("ic_gift"),ge=d("ic_message_retry"),we=d("img_account_sync_github_white"),ye=d("Discord"),fe=d("img_account_sync_twitter_white"),he=ne("acceptInviteAndTransitionToInviteChannel");var be=({settings:e})=>{const n=X.createThemedStyleSheet({container:{flexDirection:"row",justifyContent:"center",alignItems:"center"},image:{width:70,height:70,marginTop:20,marginLeft:20},title:{flexDirection:"column"},name:{fontSize:30,paddingTop:20,paddingLeft:20,paddingRight:30,color:E.ThemeColorMap.HEADER_PRIMARY},author:{fontSize:15,paddingLeft:50,color:E.ThemeColorMap.HEADER_SECONDARY},info:{height:45,paddingTop:3,paddingBottom:3,justifyContent:"center",alignItems:"center"},footer:{color:E.ThemeColorMap.HEADER_SECONDARY,textAlign:"center",paddingTop:10,paddingBottom:20}});return s.createElement(O,null,s.createElement(G,{style:n.container},s.createElement(Z,{source:{uri:"https://avatars.githubusercontent.com/u/43488869"},style:n.image}),s.createElement(G,{style:n.title},s.createElement(k,{style:n.name},"SecretMessage"),s.createElement(k,{style:n.author},"by mafu"))),s.createElement(U,{title:"SETTING"},s.createElement(p,{title:"Key",placeholder:"Input key you shared with your friend",value:e.get("key"),onSubmitEditing:o=>{e.set("key",o.nativeEvent.text)}}),s.createElement(a,{label:"Enable encryption",subLabel:"You can also enable it by tapping on the button in chat input if you enable the option below.",leading:s.createElement(a.Icon,{source:de}),trailing:s.createElement($,{value:e.getBoolean("enabled",!1),onValueChange:o=>{e.set("enabled",o)}})}),s.createElement(a,{label:"Hijack gift button",subLabel:"Hijack useless gift button and change it to useful button :p",leading:s.createElement(a.Icon,{source:ue}),trailing:s.createElement($,{value:e.getBoolean("hijack_gift",!1),onValueChange:o=>{e.set("hijack_gift",o)}})}),s.createElement(a,{label:"Reload Discord",trailing:a.Arrow,leading:s.createElement(a.Icon,{source:ge}),subLabel:"You need to reload Discord if you wanna apply changes to loaded messages too.",onPress:()=>{me()}})),s.createElement(U,{title:"INFORMATION"},s.createElement(a,{label:"Follow me on Twitter",style:n.info,trailing:a.Arrow,leading:s.createElement(a.Icon,{source:fe}),onPress:()=>{C.openURL("https://twitter.com/m4fn3")}}),s.createElement(a,{label:"Visit my server for help",style:n.info,trailing:a.Arrow,leading:s.createElement(a.Icon,{source:ye}),onPress:()=>{he.acceptInviteAndTransitionToInviteChannel({inviteKey:"TrCqPTCrdq",context:{location:"Invite Button Embed"},callback:()=>{Q.pop()}})}}),s.createElement(a,{label:"Check Source on GitHub",style:n.info,trailing:a.Arrow,leading:s.createElement(a.Icon,{source:we}),onPress:()=>{C.openURL("https://github.com/m4fn3/SecretMessage")}})),s.createElement(k,{style:n.footer},`v${V}`))};const Se=ee(e=>e._dispatcher._actionHandlers._dependencyGraph.nodes),I=Se._dispatcher._actionHandlers._dependencyGraph.nodes;function ve(e){let n=Object.keys(I).filter(o=>I[o].name===e);if(n)return I[n[0]].actionHandler}function S(e,n,o){window.enmity.settings.set(e,n,o)}function u(e,n,o){return window.enmity.settings.get(e,n,o)}function M(e,n){let o="";for(let l=0;l<e.length;l++)o+=String.fromCharCode(e.charCodeAt(l)^n.charCodeAt(l%n.length));return o}function j(e){return`|${M("secret",e).slice(0,3)}|`}function T(e){return`\`<${e.slice(0,2)}${"*".repeat(Math.max(e.length-2,0))}>\``}function F(e){let n=u(c,"key"),o=j(n),l=T(n);return e.startsWith(o)?`${M(e.slice(0,-1).replace(o,""),n)} ${l}`:e}function K(e){let n=u(c,"key");return`${j(n)}${M(e,n)}|`}var Y;(function(e){e[e.BuiltIn=0]="BuiltIn",e[e.Guild=1]="Guild",e[e.DM=2]="DM"})(Y||(Y={}));var B;(function(e){e[e.Chat=1]="Chat",e[e.User=2]="User",e[e.Message=3]="Message"})(B||(B={}));var R;(function(e){e[e.BuiltIn=0]="BuiltIn",e[e.BuiltInText=1]="BuiltInText",e[e.BuiltInIntegration=2]="BuiltInIntegration",e[e.Bot=3]="Bot",e[e.Placeholder=4]="Placeholder"})(R||(R={}));var q;(function(e){e[e.Role=1]="Role",e[e.User=2]="User"})(q||(q={}));var D;(function(e){e[e.SubCommand=1]="SubCommand",e[e.SubCommandGroup=2]="SubCommandGroup",e[e.String=3]="String",e[e.Integer=4]="Integer",e[e.Boolean=5]="Boolean",e[e.User=6]="User",e[e.Channel=7]="Channel",e[e.Role=8]="Role",e[e.Mentionnable=9]="Mentionnable",e[e.Number=10]="Number",e[e.Attachment=11]="Attachment"})(D||(D={}));var z;(function(e){e[e.ApplicationCommand=2]="ApplicationCommand",e[e.MessageComponent=3]="MessageComponent"})(z||(z={}));const Ee=d("img_nitro_star"),_e={id:"secret",name:"secret",displayName:"secret",description:"Set key of SecretMessage",displayDescription:"Set key of SecretMessage",type:B.Chat,inputType:R.BuiltInText,options:[{name:"key",displayName:"key",description:"new key",displayDescription:"new key",type:D.String,required:!0}],execute:async function(e,n){let o=e[e.findIndex(l=>l.name==="key")].value;S(c,"key",o),J.open({content:`Successfully set new key to ${o}`,source:Ee})}},g=se("SecretMessage"),[N]=[ve("MessageStore")],[x,ke]=te(H.byProps("openSystemKeyboard"),H.byName("ChatInput",!1)),Ie=d("ic_show_password"),Me=d("ic_hide_password");function Fe(e,n,o=!1){(o||u(c,e)===void 0)&&S(c,e,n)}const Be={...ce,onStart(){this.commands=[_e],[["enabled",!1],["key","default"],["hijack_gift",!0]].forEach(l=>{Fe(...l)});let e=null,n=d("ic_send"),o="#5865f2";g.after(A.type,"render",(l,i,m)=>{var r,w,y,L,P;if(typeof((y=(w=(r=m.props)==null?void 0:r.children[0])==null?void 0:w.props)==null?void 0:y.source)=="number"){let b=m.props.children[0].props.source,f=null;if(e&&b==e)f="gift";else if(b==n)f="send";else if(!e&&re(b).httpServerLocation==="/assets/modules/chat_input/native/images")e=b,f="gift";else return;if(f=="gift")m.props.children[0].props.source=u(c,"enabled")?Me:Ie,i[0].onPress=()=>{S(c,"enabled",!u(c,"enabled")),x.setText(""),x.openSystemKeyboard(),x.dismissKeyboard()};else if(f=="send"){let v=(P=(L=m.props)==null?void 0:L.style[0][1])==null?void 0:P.backgroundColor;v&&v!="#e74c3c"&&(o=v),m.props.style[0][1].backgroundColor=u(c,"enabled")?"#e74c3c":o}}}),g.after(ke.default.prototype,"render",(l,i,m)=>{let r=oe(m,w=>{var y;return(y=w.props)==null?void 0:y.placeholder});r&&(r.props.placeholder=u(c,"enabled")?"Send *secret* message":"Send normal message")}),g.before(N,"LOAD_MESSAGES_SUCCESS",(l,i,m)=>{i[0].messages=i[0].messages.map(r=>(r.content=r.content?F(r.content):r.content,r))}),g.before(N,"MESSAGE_CREATE",(l,i,m)=>{let r=i[0].message.content;i[0].message.content=r&&F(r)}),g.before(N,"MESSAGE_UPDATE",(l,i,m)=>{let r=i[0].message.content;i[0].message.content=r&&F(r)}),g.before(_,"sendMessage",(l,i,m)=>{if(u(c,"enabled")){let r=i[1].content;i[1].content=r&&K(r)}}),g.before(_,"editMessage",(l,i,m)=>{if(u(c,"enabled")){let r=i[2].content;i[2].content=r&&K(r)}}),g.before(_,"startEditMessage",(l,i,m)=>{let r=u(c,"key"),w=T(r);i[2]=i[2].replace(w,"")})},onStop(){this.commands=[],g.unpatchAll()},getSettingsPanel({settings:e}){return s.createElement(be,{settings:e})}};W(Be);
